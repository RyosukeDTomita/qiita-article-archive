---
title: 【知らないと大失敗するかも!?】nmapのオプション
tags:
  - Nmap
  - ポートスキャン
  - 脆弱性診断
private: false
updated_at: '2024-09-06T13:54:09+09:00'
id: 034348750ed57dcc9a61
organization_url_name: null
slide: false
ignorePublish: false
---
## 記事の目的

nmapのオプションミスを晒すことで同じ被害者を防ぐのが目的。

---

## 失敗1. オプションを間違えているのにコマンドが通ってしまい，--max-rtt-timeoutが効いていないのに気づけなかった。

```shell
sudo nmap -max-rtt-timeout=300ms localhost
```
のように設定してしまった。
正しくは`--max-rtt-timeout`である。

> [公式ドキュメント](https://nmap.org/man/ja/man-briefoptions.html)

### この間違いで何が起きるか

- 公式ドキュメントに記載はないが，nmapには`-m`というオプションがあるらしく，これがファイル名を指定する系のオプションらしい。
- 自分が`--max-rtt-timeout`ではなく，`-max-rtt-timeout`にしていたことでnmapに`-m`でax-rtt-timeoutというファイル名で出力すると解釈されてしまった。
- 結果として，**指定したタイムアウト時間が機能せず，一生ポートスキャンが終わらない**という悲劇が発生した(今回は対象ホストがものすごく多かったのでかなり時間の無駄になった)。

### 対策

- あまりに遅いときには疑問を持つようにする。
  - ツールを流して終わりにしない。
  - ツールの実行時間をある程度見積もっておく。

- コマンドが正しいことを事前に確認する。最悪gptに投げて聞くでも良い。

---

## 失敗2. `-PS`オプションが効かないことを知らなかった。

```shell
nmap -PS22 localhost
```
のように実行すれば22にしかポートスキャンが行かないと思っていたが，他のポートにもスキャンが飛んでいたため，かなりポートスキャンの時間が伸びてしまった。

### 対策
- `-p`を使おう。
